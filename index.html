<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –ü—Ä–∏–≤—ã—á–µ–∫</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4CAF50;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333;
            --border: #e0e0e0;
            --danger: #ff6b6b;
            --header-bg: #e8f5e9;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- Header & Controls --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 { margin: 0; font-size: 1.5rem; }

        .controls select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 1rem;
            background: var(--card-bg);
        }

        /* --- Dashboard (Top Section) --- */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .top-habits h3, .chart-container h3 {
            margin-top: 0;
            font-size: 1rem;
            color: #666;
        }

        .top-list {
            list-style: none;
            padding: 0;
        }

        .top-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
        }
        .top-item:last-child { border-bottom: none; }
        .top-score { font-weight: bold; color: var(--primary); }

        /* --- Main Tracker Table --- */
        .tracker-wrapper {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
            position: relative;
        }

        .table-scroll {
            overflow-x: auto;
            /* Smooth scrolling */
            -webkit-overflow-scrolling: touch; 
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; /* Force scroll on mobile */
        }

        th, td {
            padding: 10px;
            border: 1px solid var(--border);
            text-align: center;
            font-size: 0.85rem;
        }

        /* Sticky First Column (Habit Names) */
        th:first-child, td:first-child {
            position: sticky;
            left: 0;
            background: var(--card-bg);
            z-index: 2;
            text-align: left;
            min-width: 180px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }
        
        th { background: var(--header-bg); font-weight: 600; }

        /* Habit Rows */
        .habit-name { display: flex; align-items: center; gap: 8px; }
        .habit-icon { font-size: 1.2rem; }

        /* Checkboxes */
        .day-check {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        /* Progress Bars */
        .progress-bar-bg {
            background: #eee;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            width: 80px;
            margin: 0 auto;
        }
        .progress-bar-fill {
            background: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Percentage Badge */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        .badge-high { background: #e8f5e9; color: #2e7d32; }
        .badge-med { background: #fff3e0; color: #ef6c00; }
        .badge-low { background: #ffebee; color: #c62828; }

        /* Weekly Summary Row */
        .summary-row td {
            background: #fafafa;
            font-weight: bold;
            color: #666;
        }

        /* Add Habit Button */
        .add-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .add-btn:hover { background: #43a047; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>–¢—Ä–µ–∫–µ—Ä –ü—Ä–∏–≤—ã—á–µ–∫</h1>
            <small style="color: #666">–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è GitHub ‚Ä¢ –í–µ—Ä—Å–∏—è 1.0</small>
        </div>
        <div class="controls">
            <select id="monthSelect"></select>
            <select id="yearSelect">
                <option value="2025">2025</option>
                <option value="2026" selected>2026</option>
            </select>
        </div>
    </header>

    <div class="dashboard">
        <div class="card top-habits">
            <h3>–¢–û–ü-5 –ü—Ä–∏–≤—ã—á–µ–∫</h3>
            <ul class="top-list" id="topList">
                </ul>
        </div>
        
        <div class="card chart-container">
            <h3>–ú–µ—Å—è—á–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
            <div style="height: 200px; width: 100%;">
                <canvas id="progressChart"></canvas>
            </div>
        </div>
    </div>

    <div class="tracker-wrapper">
        <div class="table-scroll">
            <table id="habitTable">
                <thead>
                    <tr id="headerRow">
                        <th>–ï–ñ–ï–î–ù–ï–í–ù–´–ï –ü–†–ò–í–´–ß–ö–ò</th>
                        <th>–¶–µ–ª—å</th>
                        <th>–°–¥–µ–ª–∞–Ω–æ</th>
                        <th>–û—Å—Ç–∞–ª–æ—Å—å</th>
                        <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                        <th>%</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <button class="add-btn" onclick="addNewHabit()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
</div>

<script>
    // --- Data & State ---
    const months = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
    
    // Default Habits from screenshot
    const defaultHabits = [
        { id: 1, name: "–ß—Ç–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å", icon: "üìö", goal: 25 },
        { id: 2, name: "–ú–µ–¥–∏—Ç–∞—Ü–∏—è", icon: "üßò", goal: 18 },
        { id: 3, name: "–û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ", icon: "ü•ó", goal: 30 },
        { id: 4, name: "–î–≤–∞ —á–∞—Å–∞ –±–µ–∑ —Å–æ—Ü —Å–µ—Ç–µ–π", icon: "üìµ", goal: 21 },
        { id: 5, name: "–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –∏—Ç–æ–≥–æ–≤", icon: "‚úçÔ∏è", goal: 30 },
        { id: 6, name: "–°–ø–æ—Ä—Ç / —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", icon: "üèãÔ∏è", goal: 17 }
    ];

    let currentYear = 2026;
    let currentMonth = 0; // 0 = Jan
    let habitData = JSON.parse(localStorage.getItem('habitData_v1')) || {};
    let chartInstance = null;

    // Initialize
    window.onload = () => {
        initControls();
        renderApp();
    };

    function initControls() {
        const mSelect = document.getElementById('monthSelect');
        months.forEach((m, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.innerText = m;
            if(i === new Date().getMonth()) opt.selected = true;
            mSelect.appendChild(opt);
        });
        currentMonth = parseInt(mSelect.value);

        mSelect.addEventListener('change', (e) => {
            currentMonth = parseInt(e.target.value);
            renderApp();
        });

        document.getElementById('yearSelect').addEventListener('change', (e) => {
            currentYear = parseInt(e.target.value);
            renderApp();
        });
    }

    // --- Core Render Logic ---
    function renderApp() {
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const dataKey = `${currentYear}-${currentMonth}`;
        
        // Ensure data structure exists for this month
        if (!habitData[dataKey]) {
            habitData[dataKey] = defaultHabits.map(h => ({
                ...h,
                checks: Array(32).fill(false) // index 1-31
            }));
        }
        
        const currentData = habitData[dataKey];
        renderTable(daysInMonth, currentData);
        updateStats(daysInMonth, currentData);
    }

    function renderTable(days, habits) {
        const headerRow = document.getElementById('headerRow');
        const tbody = document.getElementById('tableBody');
        
        // 1. Rebuild Header (keep static columns, regen days)
        // Clear old days (between Goal and Done)
        while (headerRow.children.length > 2 + 4) { 
            headerRow.removeChild(headerRow.children[2]);
        }
        
        // Insert Day Headers
        const frag = document.createDocumentFragment();
        // Insert before the last 4 columns (Done, Left, Prog, %)
        const refNode = headerRow.children[2]; 
        
        for(let d=1; d<=days; d++) {
            const th = document.createElement('th');
            th.innerText = d;
            th.style.minWidth = "30px";
            // Highlight weekends logic could go here
            frag.appendChild(th);
        }
        headerRow.insertBefore(frag, refNode);

        // 2. Render Rows
        tbody.innerHTML = '';
        habits.forEach((habit, hIndex) => {
            const tr = document.createElement('tr');
            
            // Name
            tr.innerHTML = `
                <td>
                    <div class="habit-name">
                        <span class="habit-icon">${habit.icon}</span>
                        ${habit.name}
                    </div>
                </td>
                <td>${habit.goal}</td>
            `;

            // Checkboxes
            for(let d=1; d<=days; d++) {
                const td = document.createElement('td');
                const cb = document.createElement('input');
                cb.type = 'checkbox';
                cb.className = 'day-check';
                cb.checked = habit.checks[d];
                cb.onclick = () => toggleCheck(hIndex, d, cb.checked);
                td.appendChild(cb);
                tr.appendChild(td);
            }

            // Stats Columns
            const doneCount = habit.checks.filter(Boolean).length;
            const remaining = Math.max(0, habit.goal - doneCount);
            const percent = Math.round((doneCount / habit.goal) * 100) || 0;
            const badgeClass = percent >= 80 ? 'badge-high' : (percent >= 50 ? 'badge-med' : 'badge-low');

            tr.innerHTML += `
                <td>${doneCount}</td>
                <td>${remaining}</td>
                <td>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" style="width: ${Math.min(100, percent)}%"></div>
                    </div>
                </td>
                <td><span class="badge ${badgeClass}">${percent}%</span></td>
            `;

            tbody.appendChild(tr);
        });
    }

    // --- Actions ---
    function toggleCheck(habitIndex, day, isChecked) {
        const key = `${currentYear}-${currentMonth}`;
        habitData[key][habitIndex].checks[day] = isChecked;
        saveData();
        renderApp(); // Re-render to update stats/charts
    }

    function addNewHabit() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏:");
        if(!name) return;
        const goal = parseInt(prompt("–¶–µ–ª—å (–¥–Ω–µ–π):", "30")) || 30;
        
        const key = `${currentYear}-${currentMonth}`;
        habitData[key].push({
            id: Date.now(),
            name: name,
            icon: "‚ú®",
            goal: goal,
            checks: Array(32).fill(false)
        });
        saveData();
        renderApp();
    }

    function saveData() {
        localStorage.setItem('habitData_v1', JSON.stringify(habitData));
    }

    // --- Stats & Charts ---
    function updateStats(daysInMonth, habits) {
        // 1. Top 5 List
        const sorted = [...habits].sort((a,b) => {
            const pa = (a.checks.filter(Boolean).length / a.goal);
            const pb = (b.checks.filter(Boolean).length / b.goal);
            return pb - pa;
        }).slice(0, 5);

        const list = document.getElementById('topList');
        list.innerHTML = sorted.map(h => {
            const p = Math.round((h.checks.filter(Boolean).length / h.goal) * 100);
            return `<li class="top-item">
                <span>${h.icon} ${h.name}</span>
                <span class="top-score">${p}%</span>
            </li>`;
        }).join('');

        // 2. Line Chart (Total Daily Completion %)
        const dailyData = [];
        for(let d=1; d<=daysInMonth; d++) {
            let totalChecks = 0;
            habits.forEach(h => { if(h.checks[d]) totalChecks++; });
            // Calculate % of habits done that day vs total active habits
            const dailyPercent = Math.round((totalChecks / habits.length) * 100);
            dailyData.push(dailyPercent);
        }

        const ctx = document.getElementById('progressChart').getContext('2d');
        if(chartInstance) chartInstance.destroy();

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: daysInMonth}, (_, i) => i + 1),
                datasets: [{
                    label: '–û–±—â–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (%)',
                    data: dailyData,
                    borderColor: '#4CAF50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, max: 100 }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
    }

</script>

</body>
</html>
