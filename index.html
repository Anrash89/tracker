<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyLife OS - Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2d3436;
            --accent-green: #00b894;
            --accent-red: #d63031;
            --accent-blue: #0984e3;
            --accent-purple: #6c5ce7;
            --bg-color: #f5f6fa;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-light: #b2bec3;
            --shadow: 0 10px 20px rgba(0,0,0,0.05);
            --radius: 20px;
            --nav-height: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-main); padding-bottom: calc(var(--nav-height) + 20px); overflow-x: hidden; }
        
        /* === –£–¢–ò–õ–ò–¢–´ === */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .center { display: flex; justify-content: center; align-items: center; }
        .col { flex-direction: column; }
        .between { justify-content: space-between; }
        .bold { font-weight: 700; }
        
        /* === –≠–ö–†–ê–ù –í–•–û–î–ê (Paywall) === */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;
        }
        .auth-card {
            background: white; width: 100%; max-width: 400px; padding: 40px 30px;
            border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); text-align: center;
        }
        .logo { font-size: 2rem; font-weight: 800; margin-bottom: 10px; background: -webkit-linear-gradient(#667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .auth-input {
            width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #f0f0f0; border-radius: 12px; font-size: 1rem; outline: none; transition: 0.3s;
        }
        .auth-input:focus { border-color: #6c5ce7; }
        .btn-primary {
            width: 100%; padding: 15px; background: #6c5ce7; color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; margin-top: 10px; transition: 0.2s;
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }
        .btn-primary:active { transform: scale(0.98); }
        .sub-text { font-size: 0.8rem; color: #888; margin-top: 15px; }

        /* === –û–°–ù–û–í–ù–û–ô –õ–ï–ô–ê–£–¢ === */
        .app-header {
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            background: white; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .date-picker {
            background: #f1f2f6; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9rem; border: none; outline: none;
        }
        
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .view-section { animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === –ö–ê–†–¢–û–ß–ö–ò === */
        .card {
            background: var(--card-bg); border-radius: var(--radius); padding: 20px;
            margin-bottom: 20px; box-shadow: var(--shadow); position: relative; overflow: hidden;
        }
        
        /* === –ü–†–ò–í–´–ß–ö–ò === */
        .habit-header-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #f8f9fa; padding: 15px; border-radius: 16px; text-align: center; }
        .stat-num { font-size: 1.5rem; font-weight: 800; color: var(--accent-green); }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; color: #b2bec3; letter-spacing: 1px; }
        
        /* –ì—Ä–∞—Ñ–∏–∫-—Å–ø–∞—Ä–∫–ª–∞–π–Ω */
        .chart-container { width: 100%; height: 60px; display: flex; align-items: flex-end; gap: 2px; margin-top: 10px; }
        .chart-bar { flex: 1; background: #dfe6e9; border-radius: 2px; transition: height 0.5s; }
        .chart-bar.active { background: var(--accent-green); }

        .habit-row {
            display: flex; align-items: center; justify-content: space-between; padding: 15px 0;
            border-bottom: 1px solid #f1f2f6;
        }
        .habit-info h4 { font-size: 1rem; margin-bottom: 5px; }
        .habit-info p { font-size: 0.8rem; color: var(--text-light); }
        .habit-progress-bar {
            height: 6px; width: 100px; background: #f1f2f6; border-radius: 3px; overflow: hidden; margin-top: 5px;
        }
        .habit-fill { height: 100%; background: var(--accent-green); transition: width 0.3s; }
        
        .day-toggles { display: flex; gap: 5px; }
        .day-toggle {
            width: 32px; height: 32px; border-radius: 8px; border: 2px solid #f1f2f6;
            display: flex; justify-content: center; align-items: center; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: 0.2s; color: #b2bec3;
        }
        .day-toggle.done { background: var(--accent-green); border-color: var(--accent-green); color: white; box-shadow: 0 4px 10px rgba(0, 184, 148, 0.4); }

        /* === –§–ò–ù–ê–ù–°–´ === */
        .balance-hero {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white; text-align: center; padding: 30px 20px;
        }
        .balance-amount { font-size: 2.5rem; font-weight: 800; margin: 10px 0; text-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        .finance-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: -30px; padding: 0 20px; }
        .fin-stat-card { background: white; padding: 15px; border-radius: 16px; box-shadow: var(--shadow); text-align: center; }
        .income-val { color: var(--accent-green); font-weight: 700; font-size: 1.1rem; }
        .expense-val { color: var(--accent-red); font-weight: 700; font-size: 1.1rem; }

        .trans-list { margin-top: 20px; }
        .trans-item {
            display: flex; justify-content: space-between; align-items: center; padding: 15px;
            background: white; border-radius: 16px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .trans-icon {
            width: 40px; height: 40px; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; margin-right: 15px;
        }
        .trans-icon.inc { background: rgba(0, 184, 148, 0.1); color: var(--accent-green); }
        .trans-icon.exp { background: rgba(214, 48, 49, 0.1); color: var(--accent-red); }

        /* === –ü–õ–ê–ù–ï–† === */
        .planner-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .day-card { border-top: 6px solid #dfe6e9; padding-top: 15px; }
        .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .day-date { font-weight: 700; font-size: 1.1rem; }
        .day-weekday { color: var(--text-light); font-size: 0.9rem; font-style: italic; }
        
        .task-item { display: flex; align-items: center; margin-bottom: 8px; gap: 10px; }
        .custom-checkbox {
            width: 22px; height: 22px; border: 2px solid #dfe6e9; border-radius: 6px; cursor: pointer; display: flex; justify-content: center; align-items: center; color: transparent; transition: 0.2s;
        }
        .custom-checkbox.checked { background: var(--accent-purple); border-color: var(--accent-purple); color: white; }
        .task-text { flex: 1; border: none; background: transparent; font-size: 0.9rem; padding: 5px; border-bottom: 1px dashed transparent; }
        .task-text:focus { border-bottom-color: var(--accent-purple); outline: none; }
        .task-time { font-size: 0.75rem; background: #f1f2f6; padding: 4px 8px; border-radius: 6px; color: #636e72; }

        /* === FAB & MODAL === */
        .fab {
            position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px;
            background: var(--accent-purple); color: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 2rem;
            box-shadow: 0 10px 20px rgba(108, 92, 231, 0.4); cursor: pointer; transition: 0.2s; z-index: 500;
        }
        .fab:active { transform: scale(0.9); }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px); z-index: 1000; display: none; justify-content: center; align-items: flex-end;
        }
        .modal-overlay.active { display: flex; animation: slideUp 0.3s ease; }
        .modal-sheet {
            background: white; width: 100%; max-width: 600px; border-radius: 30px 30px 0 0; padding: 30px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .form-label { display: block; font-size: 0.8rem; color: #b2bec3; margin-bottom: 5px; margin-top: 15px; }
        .form-select, .form-input {
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #dfe6e9; font-size: 1rem; outline: none; background: #fdfdfd;
        }

        /* === –ù–ê–í–ò–ì–ê–¶–ò–Ø === */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: white; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); display: flex; justify-content: space-around; align-items: center; z-index: 500;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; color: #b2bec3; cursor: pointer; transition: 0.3s;
        }
        .nav-item.active { color: var(--accent-purple); transform: translateY(-5px); }
        .nav-icon { font-size: 28px; margin-bottom: 4px; }
        .nav-label { font-size: 0.7rem; font-weight: 600; }

        /* === PRO BADGE === */
        .pro-badge {
            background: gold; color: #d35400; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 800; margin-left: 5px; vertical-align: middle;
        }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <div class="logo">MyLife OS</div>
            <p style="margin-bottom: 30px;">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω—å—é <span class="pro-badge">PRO</span></p>
            
            <input type="text" id="reg-name" placeholder="–í–∞—à–µ –∏–º—è" class="auth-input">
            <input type="email" id="reg-email" placeholder="Email" class="auth-input">
            
            <button class="btn-primary" onclick="handleLogin()">–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø (99‚ÇΩ)</button>
            <p class="sub-text">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Tinkoff / SberPay</p>
            <p class="sub-text" style="margin-top: 5px; cursor: pointer; text-decoration: underline;" onclick="handleLogin()">–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</p>
        </div>
    </div>

    <div id="app-content" class="hidden">
        
        <header class="app-header">
            <div style="font-weight: 800; font-size: 1.2rem; color: var(--text-main);">
                –ü—Ä–∏–≤–µ—Ç, <span id="user-name-display">Alex</span> üëã
            </div>
            <select class="date-picker" id="month-picker" onchange="changeMonth()">
                <option value="10">–ù–æ—è–±—Ä—å 2025</option>
                <option value="11">–î–µ–∫–∞–±—Ä—å 2025</option>
                <option value="0">–Ø–Ω–≤–∞—Ä—å 2026</option>
            </select>
        </header>

        <section id="view-habits" class="view-section container">
            <div class="card">
                <div class="habit-header-stats">
                    <div class="stat-box">
                        <div class="stat-num" id="habit-total-percent">89%</div>
                        <div class="stat-label">–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-num">5</div>
                        <div class="stat-label">–¢–æ–ø –ø—Ä–∏–≤—ã—á–µ–∫</div>
                    </div>
                </div>
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">–ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–Ω–æ—è–±—Ä—å)</div>
                <div class="chart-container" id="habit-sparkline">
                    </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px;">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏</h3>
                <div id="habit-list-container">
                    </div>
            </div>
        </section>

        <section id="view-finance" class="view-section hidden">
            <div class="card balance-hero">
                <div class="stat-label" style="color: rgba(255,255,255,0.8);">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="fin-total-balance">0 ‚ÇΩ</div>
                <div style="font-size: 0.9rem; opacity: 0.9;">–ö—ç—à—Ñ–ª–æ—É: <span id="fin-cashflow">+0 ‚ÇΩ</span></div>
            </div>

            <div class="finance-grid">
                <div class="fin-stat-card">
                    <div class="income-val" id="fin-income-val">0 ‚ÇΩ</div>
                    <div class="stat-label">–î–æ—Ö–æ–¥—ã</div>
                </div>
                <div class="fin-stat-card">
                    <div class="expense-val" id="fin-expense-val">0 ‚ÇΩ</div>
                    <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã</div>
                </div>
            </div>

            <div class="container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0 10px;">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                    <div style="font-size: 0.8rem; color: var(--accent-purple);">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</div>
                </div>
                <div id="transaction-list">
                    </div>
            </div>

            <div class="fab" onclick="openModal('modal-finance')">
                <span class="material-icons">add</span>
            </div>
        </section>

        <section id="view-planner" class="view-section container hidden">
            <h3 style="margin-bottom: 15px;">–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á</h3>
            <div class="planner-grid" id="planner-container">
                </div>
        </section>

    </div>

    <div class="modal-overlay" id="modal-finance" onclick="if(event.target === this) closeModal('modal-finance')">
        <div class="modal-sheet">
            <h2>–ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h2>
            
            <label class="form-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
            <div style="display: flex; gap: 10px;">
                <button class="btn-primary" style="flex: 1; background: var(--accent-red);" onclick="setTransType('expense')">–†–∞—Å—Ö–æ–¥</button>
                <button class="btn-primary" style="flex: 1; background: var(--accent-green);" onclick="setTransType('income')">–î–æ—Ö–æ–¥</button>
            </div>
            <input type="hidden" id="new-trans-type" value="expense">

            <label class="form-label">–°—É–º–º–∞</label>
            <input type="number" id="new-trans-amount" class="form-input" placeholder="0 ‚ÇΩ">

            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="new-trans-cat" class="form-select">
                <option>–ü—Ä–æ–¥—É–∫—Ç—ã</option> <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option> <option>–ö–∞—Ñ–µ</option>
                <option>–ê—Ä–µ–Ω–¥–∞</option> <option>–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
            </select>

            <label class="form-label">–ê–≤—Ç–æ—Ä (–ö—Ç–æ —Ç—Ä–∞—Ç–∏—Ç?)</label>
            <select id="new-trans-author" class="form-select">
                <option>–Ø (–ú—É–∂)</option>
                <option>–ñ–µ–Ω–∞</option>
                <option>–û–±—â–µ–µ</option>
            </select>

            <button class="btn-primary" style="margin-top: 25px;" onclick="addTransaction()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <nav class="bottom-nav hidden" id="main-nav">
        <div class="nav-item active" onclick="switchView('habits')">
            <span class="material-icons nav-icon">check_circle</span>
            <span class="nav-label">–ü—Ä–∏–≤—ã—á–∫–∏</span>
        </div>
        <div class="nav-item" onclick="switchView('finance')">
            <span class="material-icons nav-icon">account_balance_wallet</span>
            <span class="nav-label">–§–∏–Ω–∞–Ω—Å—ã</span>
        </div>
        <div class="nav-item" onclick="switchView('planner')">
            <span class="material-icons nav-icon">event_note</span>
            <span class="nav-label">–ü–ª–∞–Ω–µ—Ä</span>
        </div>
    </nav>

    <script>
        // === 1. –ë–ê–ó–ê –î–ê–ù–ù–´–• (Local Storage Simulation) ===
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ç—É—Ç –±—É–¥–µ—Ç Firebase –∏–ª–∏ Supabase
        
        const DB = {
            user: localStorage.getItem('mylife_user') || null,
            habits: JSON.parse(localStorage.getItem('mylife_habits')) || [
                {id: 1, name: "–ß—Ç–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç", goal: 30, history: {}}, 
                {id: 2, name: "–ú–µ–¥–∏—Ç–∞—Ü–∏—è", goal: 20, history: {}},
                {id: 3, name: "–°–ø–æ—Ä—Ç / –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", goal: 15, history: {}},
                {id: 4, name: "–ë–µ–∑ —Å–æ—Ü—Å–µ—Ç–µ–π", goal: 25, history: {}}
            ],
            finance: JSON.parse(localStorage.getItem('mylife_finance')) || [
                {id: 1, date: '2025-11-01', type: 'expense', amount: 2500, cat: '–ü—Ä–æ–¥—É–∫—Ç—ã', author: '–Ø (–ú—É–∂)'},
                {id: 2, date: '2025-11-05', type: 'income', amount: 150000, cat: '–ó–∞—Ä–ø–ª–∞—Ç–∞', author: '–Ø (–ú—É–∂)'},
                {id: 3, date: '2025-11-13', type: 'expense', amount: 45000, cat: '–ê—Ä–µ–Ω–¥–∞', author: '–û–±—â–µ–µ'}
            ],
            planner: JSON.parse(localStorage.getItem('mylife_planner')) || {},

            save() {
                localStorage.setItem('mylife_habits', JSON.stringify(this.habits));
                localStorage.setItem('mylife_finance', JSON.stringify(this.finance));
                localStorage.setItem('mylife_planner', JSON.stringify(this.planner));
            }
        };

        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentState = {
            view: 'habits',
            year: 2025,
            month: 10 // –ù–æ—è–±—Ä—å (JS —Å—á–∏—Ç–∞–µ—Ç —Å 0)
        };

        // === 2. –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===
        function handleLogin() {
            const name = document.getElementById('reg-name').value || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
            localStorage.setItem('mylife_user', name);
            document.getElementById('user-name-display').innerText = name;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —É—Ö–æ–¥–∞ —ç–∫—Ä–∞–Ω–∞
            document.getElementById('auth-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                initApp();
            }, 500);
        }

        // === 3. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        function initApp() {
            if(DB.user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-content').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('user-name-display').innerText = DB.user;
            }
            renderHabits();
            renderFinance();
            renderPlanner();
            renderSparkline();
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if(DB.user) initApp();

        // === 4. –ù–ê–í–ò–ì–ê–¶–ò–Ø ===
        function switchView(viewName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—É—é
            document.getElementById('view-' + viewName).classList.remove('hidden');
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏
            const navIndex = ['habits', 'finance', 'planner'].indexOf(viewName);
            document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
        }

        function changeMonth() {
            currentState.month = parseInt(document.getElementById('month-picker').value);
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞
            renderHabits();
            renderPlanner(); 
            // –§–∏–Ω–∞–Ω—Å—ã –º–æ–∂–Ω–æ —Ç–æ–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å
        }

        // === 5. –õ–û–ì–ò–ö–ê: –ü–†–ò–í–´–ß–ö–ò ===
        function renderHabits() {
            const container = document.getElementById('habit-list-container');
            container.innerHTML = '';
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–π —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (—Å–∏–º—É–ª—è—Ü–∏—è)
            const daysToShow = [1,2,3,4,5,6,7]; // –ü–Ω-–í—Å

            DB.habits.forEach(habit => {
                const completedCount = Object.keys(habit.history).filter(k => k.startsWith(`${currentState.year}-${currentState.month}`)).length;
                const progressPercent = Math.min(100, Math.round((completedCount / habit.goal) * 100));

                let daysHTML = '';
                daysToShow.forEach(day => {
                    // –ö–ª—é—á –¥–∞—Ç—ã: 2025-10-Day
                    const key = `${currentState.year}-${currentState.month}-${day}`;
                    const isDone = habit.history[key];
                    daysHTML += `
                        <div class="day-toggle ${isDone ? 'done' : ''}" onclick="toggleHabit(${habit.id}, ${day})">
                            ${day}
                        </div>
                    `;
                });

                const html = `
                    <div class="habit-row">
                        <div class="habit-info">
                            <h4>${habit.name}</h4>
                            <div class="day-toggles">${daysHTML}</div>
                        </div>
                        <div style="text-align: right;">
                            <span class="stat-num" style="font-size: 1rem;">${progressPercent}%</span>
                            <div class="habit-progress-bar">
                                <div class="habit-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
            
            // –û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç (—Ñ–µ–π–∫–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
            document.getElementById('habit-total-percent').innerText = Math.floor(Math.random() * (95 - 80) + 80) + "%";
        }

        function toggleHabit(id, day) {
            const habit = DB.habits.find(h => h.id === id);
            const key = `${currentState.year}-${currentState.month}-${day}`;
            
            if(habit.history[key]) delete habit.history[key];
            else habit.history[key] = true;
            
            DB.save();
            renderHabits();
        }

        function renderSparkline() {
            const container = document.getElementById('habit-sparkline');
            let html = '';
            for(let i=0; i<30; i++) {
                const h = Math.floor(Math.random() * 80 + 20); // –°–ª—É—á–∞–π–Ω–∞—è –≤—ã—Å–æ—Ç–∞
                const active = i > 25 ? 'active' : ''; // –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ –∞–∫—Ç–∏–≤–Ω—ã
                html += `<div class="chart-bar ${active}" style="height: ${h}%"></div>`;
            }
            container.innerHTML = html;
        }

        // === 6. –õ–û–ì–ò–ö–ê: –§–ò–ù–ê–ù–°–´ ===
        function renderFinance() {
            const list = document.getElementById('transaction-list');
            list.innerHTML = '';
            let income = 0, expense = 0;

            DB.finance.forEach(t => {
                if(t.type === 'income') income += t.amount;
                else expense += t.amount;

                const icon = t.type === 'income' ? 'arrow_downward' : 'shopping_bag';
                const colorClass = t.type === 'income' ? 'inc' : 'exp';
                const sign = t.type === 'income' ? '+' : '-';
                const amountColor = t.type === 'income' ? 'var(--accent-green)' : 'var(--text-main)';

                const html = `
                    <div class="trans-item">
                        <div class="flex center">
                            <div class="trans-icon ${colorClass}">
                                <span class="material-icons">${icon}</span>
                            </div>
                            <div>
                                <div class="bold">${t.cat}</div>
                                <div style="font-size: 0.8rem; color: #b2bec3;">${t.author} ‚Ä¢ ${t.date.slice(5)}</div>
                            </div>
                        </div>
                        <div class="bold" style="color: ${amountColor};">${sign} ${t.amount.toLocaleString()} ‚ÇΩ</div>
                    </div>
                `;
                list.innerHTML += html;
            });

            document.getElementById('fin-total-balance').innerText = (income - expense).toLocaleString() + " ‚ÇΩ";
            document.getElementById('fin-cashflow').innerText = (income - expense > 0 ? "+" : "") + (income - expense).toLocaleString() + " ‚ÇΩ";
            document.getElementById('fin-income-val').innerText = income.toLocaleString() + " ‚ÇΩ";
            document.getElementById('fin-expense-val').innerText = expense.toLocaleString() + " ‚ÇΩ";
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        function setTransType(type) {
            document.getElementById('new-trans-type').value = type;
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è (—É–ø—Ä–æ—â–µ–Ω–æ)
            alert("–í—ã–±—Ä–∞–Ω —Ç–∏–ø: " + (type==='income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'));
        }

        function addTransaction() {
            const type = document.getElementById('new-trans-type').value;
            const amount = parseInt(document.getElementById('new-trans-amount').value);
            const cat = document.getElementById('new-trans-cat').value;
            const author = document.getElementById('new-trans-author').value;

            if(!amount) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");

            DB.finance.unshift({
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                type, amount, cat, author
            });
            DB.save();
            renderFinance();
            closeModal('modal-finance');
        }

        // === 7. –õ–û–ì–ò–ö–ê: –ü–õ–ê–ù–ï–† ===
        function renderPlanner() {
            const container = document.getElementById('planner-container');
            container.innerHTML = '';

            const daysInMonth = 30; // –£–ø—Ä–æ—â–µ–Ω–æ
            const weekDays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

            for(let d=1; d<=daysInMonth; d++) {
                const dateKey = `${currentState.year}-${currentState.month}-${d}`;
                const tasks = DB.planner[dateKey] || [];
                const dayName = weekDays[(d-1) % 7];
                const color = ["#fff2cc", "#d9ead3", "#cfe2f3", "#fad390"][(d-1)%4]; // –¶–≤–µ—Ç–∞ —à–∞–ø–∫–∏

                // –†–µ–Ω–¥–µ—Ä 3-—Ö –∑–∞–¥–∞—á –¥–ª—è –¥–µ–º–æ
                let tasksHTML = '';
                for(let i=0; i<3; i++) {
                    const t = tasks[i] || {text: '', done: false, time: ''};
                    tasksHTML += `
                        <div class="task-item">
                            <div class="custom-checkbox ${t.done ? 'checked' : ''}" onclick="toggleTask('${dateKey}', ${i})">
                                <span class="material-icons" style="font-size: 16px;">check</span>
                            </div>
                            <input type="text" class="task-text" value="${t.text}" placeholder="–ó–∞–¥–∞—á–∞..." onchange="saveTask('${dateKey}', ${i}, this.value)">
                            ${t.time ? `<span class="task-time">${t.time}</span>` : ''}
                        </div>
                    `;
                }

                const html = `
                    <div class="card day-card" style="border-top-color: ${color}">
                        <div class="day-header">
                            <div class="day-date">${d} –ù–æ—è–±—Ä—è</div>
                            <div class="day-weekday">${dayName}</div>
                        </div>
                        <div class="task-list">
                            ${tasksHTML}
                        </div>
                        <div style="margin-top: 10px; font-size: 0.8rem; color: #b2bec3; text-align: right;">
                            –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: üôÇ
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            }
        }

        function saveTask(dateKey, index, text) {
            if(!DB.planner[dateKey]) DB.planner[dateKey] = [];
            if(!DB.planner[dateKey][index]) DB.planner[dateKey][index] = {done: false, time: '10:00'};
            
            DB.planner[dateKey][index].text = text;
            DB.save();
        }

        function toggleTask(dateKey, index) {
            if(!DB.planner[dateKey] || !DB.planner[dateKey][index]) return;
            DB.planner[dateKey][index].done = !DB.planner[dateKey][index].done;
            DB.save();
            renderPlanner();
        }

    </script>
</body>
</html>
